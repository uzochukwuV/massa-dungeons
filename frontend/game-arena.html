<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Massa Dungeons - PVP Arena</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background: #0a0a0a;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        /* Fighting Arena */
        .arena {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
            background-image:
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Health Bars Container */
        .health-bars-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 40px;
            z-index: 100;
        }

        /* Individual Health Bar */
        .health-bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .player-info {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
        }

        .player-avatar {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            border: 3px solid rgba(255,255,255,0.2);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .player-avatar.player2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .player-name {
            font-size: 18px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .health-bar-bg {
            position: relative;
            width: 100%;
            height: 40px;
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .health-bar-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
            transition: width 0.3s ease, background 0.3s ease;
        }

        .health-bar-fill.low {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }

        .health-bar-fill.critical {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            animation: pulse-health 0.5s infinite;
        }

        @keyframes pulse-health {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 10;
        }

        /* Status Effects */
        .status-effects {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .status-icon {
            width: 32px;
            height: 32px;
            background: rgba(0,0,0,0.8);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            animation: status-pulse 1s infinite;
        }

        @keyframes status-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Timer & Round Info */
        .timer-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 101;
        }

        .timer {
            font-size: 48px;
            font-weight: 700;
            color: white;
            text-shadow: 0 0 20px rgba(255,255,255,0.5), 2px 2px 8px rgba(0,0,0,0.8);
            font-family: 'Courier New', monospace;
        }

        .timer.warning {
            color: #f59e0b;
            animation: timer-pulse 1s infinite;
        }

        .timer.danger {
            color: #ef4444;
            animation: timer-pulse 0.5s infinite;
        }

        @keyframes timer-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .round-info {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-top: 4px;
        }

        /* Character Models */
        .character-container {
            position: absolute;
            bottom: 100px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .character-container.player1 {
            left: 20%;
        }

        .character-container.player2 {
            right: 20%;
        }

        .character-model {
            width: 200px;
            height: 300px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            position: relative;
            animation: character-idle 2s ease-in-out infinite;
        }

        .character-model.player2 {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.3) 0%, rgba(245, 87, 108, 0.3) 100%);
        }

        @keyframes character-idle {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .character-model.attacking {
            animation: character-attack 0.3s ease;
        }

        @keyframes character-attack {
            0% { transform: translateX(0); }
            50% { transform: translateX(30px); }
            100% { transform: translateX(0); }
        }

        .character-model.hit {
            animation: character-hit 0.3s ease;
        }

        @keyframes character-hit {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .character-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
        }

        /* Damage Indicators */
        .damage-indicator {
            position: absolute;
            pointer-events: none;
            animation: damage-float 0.5s ease-out forwards;
            z-index: 200;
        }

        .damage-triangle {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 25px solid;
        }

        .damage-triangle.light { border-bottom-color: #fbbf24; }
        .damage-triangle.moderate { border-bottom-color: #f59e0b; }
        .damage-triangle.heavy { border-bottom-color: #ef4444; }

        @keyframes damage-float {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(0.5);
            }
        }

        .damage-number {
            position: absolute;
            font-size: 32px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: damage-float 0.8s ease-out forwards;
        }

        /* Pause Button */
        .pause-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.6);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 100;
        }

        .pause-button:hover {
            background: rgba(0,0,0,0.8);
            border-color: rgba(255,255,255,0.5);
        }

        /* Input Display (Debug) */
        .input-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            z-index: 100;
        }

        .input-display.hidden {
            display: none;
        }

        .input-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 4px;
        }

        .input-value {
            font-size: 14px;
            font-weight: 600;
            color: white;
            font-family: 'Courier New', monospace;
        }

        /* Combo Counter */
        .combo-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 150;
        }

        .combo-display.hidden {
            display: none;
        }

        .combo-number {
            font-size: 80px;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.8), 4px 4px 8px rgba(0,0,0,0.8);
            animation: combo-pulse 0.3s ease;
        }

        @keyframes combo-pulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .combo-text {
            font-size: 32px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* Round Announcer */
        .round-announcer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 300;
        }

        .round-announcer.hidden {
            display: none;
        }

        .round-announcer-text {
            font-size: 120px;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 40px rgba(255,255,255,0.8), 4px 4px 16px rgba(0,0,0,0.8);
            animation: announcer-appear 1s ease;
        }

        @keyframes announcer-appear {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Victory/Defeat */
        .match-result {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 300;
        }

        .match-result.hidden {
            display: none;
        }

        .result-text {
            font-size: 100px;
            font-weight: 900;
            text-shadow: 0 0 40px currentColor, 4px 4px 16px rgba(0,0,0,0.8);
            animation: result-appear 0.5s ease;
        }

        .result-text.victory {
            color: #22c55e;
        }

        .result-text.defeat {
            color: #ef4444;
        }

        @keyframes result-appear {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        /* Pause Menu Overlay */
        .pause-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 500;
        }

        .pause-overlay.hidden {
            display: none;
        }

        .pause-menu {
            background: #1a1a1a;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            min-width: 400px;
        }

        .pause-menu h2 {
            font-size: 36px;
            font-weight: 700;
            color: white;
            margin-bottom: 30px;
        }

        .pause-menu button {
            width: 100%;
            padding: 16px;
            margin: 8px 0;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pause-menu button:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
        }

        /* Loading Indicator */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 18px;
            color: white;
        }
    </style>
</head>
<body>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Battle...</div>
    </div>

    <!-- Fighting Arena -->
    <div class="arena">

        <!-- Timer & Round Info (Top Center) -->
        <div class="timer-container">
            <div id="timer" class="timer">60</div>
            <div id="roundInfo" class="round-info">Round 1 / 3</div>
        </div>

        <!-- Health Bars Container -->
        <div class="health-bars-container">
            <!-- Player 1 Health -->
            <div class="health-bar-wrapper">
                <div class="player-info">
                    <div class="player-avatar player1">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </div>
                    <div class="player-name" id="player1Name">Player 1</div>
                </div>
                <div class="health-bar-bg">
                    <div id="player1Health" class="health-bar-fill" style="width: 100%;"></div>
                    <div class="health-text" id="player1HealthText">100 / 100</div>
                </div>
                <div class="status-effects" id="player1Status">
                    <!-- Status icons will be added here dynamically -->
                </div>
            </div>

            <!-- Player 2 Health -->
            <div class="health-bar-wrapper">
                <div class="player-info" style="flex-direction: row-reverse;">
                    <div class="player-avatar player2">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                    </div>
                    <div class="player-name" id="player2Name">Player 2</div>
                </div>
                <div class="health-bar-bg">
                    <div id="player2Health" class="health-bar-fill" style="width: 100%;"></div>
                    <div class="health-text" id="player2HealthText">100 / 100</div>
                </div>
                <div class="status-effects" id="player2Status">
                    <!-- Status icons will be added here dynamically -->
                </div>
            </div>
        </div>

        <!-- Character Models -->
        <div class="character-container player1">
            <div id="character1" class="character-model player1">
                <svg class="w-32 h-32 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
                <div class="character-label" id="character1Label">Warrior</div>
            </div>
        </div>

        <div class="character-container player2">
            <div id="character2" class="character-model player2">
                <svg class="w-32 h-32 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                </svg>
                <div class="character-label" id="character2Label">Mage</div>
            </div>
        </div>

        <!-- Pause Button -->
        <button id="pauseButton" class="pause-button">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </button>

        <!-- Input Display (Debug) -->
        <div id="inputDisplay" class="input-display hidden">
            <div class="input-label">Last Input:</div>
            <div class="input-value" id="lastInput">None</div>
            <div class="input-label" style="margin-top: 8px;">Action:</div>
            <div class="input-value" id="lastAction">-</div>
        </div>

        <!-- Combo Display -->
        <div id="comboDisplay" class="combo-display hidden">
            <div class="combo-number" id="comboNumber">3</div>
            <div class="combo-text">COMBO!</div>
        </div>

        <!-- Round Announcer -->
        <div id="roundAnnouncer" class="round-announcer hidden">
            <div class="round-announcer-text" id="announcerText">FIGHT!</div>
        </div>

        <!-- Match Result -->
        <div id="matchResult" class="match-result hidden">
            <div class="result-text victory" id="resultText">VICTORY!</div>
        </div>

    </div>

    <!-- Pause Menu Overlay -->
    <div id="pauseOverlay" class="pause-overlay hidden">
        <div class="pause-menu">
            <h2>PAUSED</h2>
            <button id="resumeButton">Resume</button>
            <button id="settingsButton">Settings</button>
            <button id="exitButton">Exit to Menu</button>
        </div>
    </div>

    <!-- Load Massa Web3 & Game SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@massalabs/massa-web3@latest/bundle.js"></script>
    <script src="game-web3.js"></script>

    <!-- Game Logic -->
    <script>
        // Game State
        let gameState = {
            battleId: null,
            player1: {
                name: 'Player 1',
                character: 'Warrior',
                hp: 100,
                maxHp: 100,
                status: []
            },
            player2: {
                name: 'Player 2',
                character: 'Mage',
                hp: 100,
                maxHp: 100,
                status: []
            },
            timer: 60,
            maxTime: 60,
            round: 1,
            maxRounds: 3,
            isPaused: false,
            comboCount: 0,
            debugMode: false
        };

        let sdk = null;
        let timerInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeGame();
            setupEventListeners();
        });

        async function initializeGame() {
            try {
                // Get battle ID from URL params
                const urlParams = new URLSearchParams(window.location.search);
                gameState.battleId = urlParams.get('battleId') || 'demo_battle';

                // TODO: Initialize SDK and load battle data
                // sdk = await initializeMassaDungeons(secretKey, contractAddress);
                // const battle = await sdk.battles.readBattle(gameState.battleId);

                // For demo, simulate loading
                setTimeout(() => {
                    document.getElementById('loadingOverlay').classList.add('hidden');
                    startRound();
                }, 2000);

            } catch (error) {
                console.error('Failed to initialize game:', error);
            }
        }

        function setupEventListeners() {
            // Pause button
            document.getElementById('pauseButton').addEventListener('click', togglePause);
            document.getElementById('resumeButton').addEventListener('click', togglePause);
            document.getElementById('exitButton').addEventListener('click', exitToMenu);

            // Keyboard controls (for demo)
            document.addEventListener('keydown', handleKeyPress);

            // Settings button
            document.getElementById('settingsButton').addEventListener('click', () => {
                alert('Settings coming soon!');
            });
        }

        function handleKeyPress(e) {
            if (gameState.isPaused) return;

            const key = e.key.toLowerCase();
            let action = '';

            // Debug mode toggle
            if (key === 'd' && e.ctrlKey) {
                gameState.debugMode = !gameState.debugMode;
                document.getElementById('inputDisplay').classList.toggle('hidden');
                return;
            }

            // Map keys to actions
            const keyMap = {
                'a': 'Left Punch',
                's': 'Right Punch',
                'd': 'Kick',
                'w': 'Jump',
                ' ': 'Block',
                'q': 'Special Attack'
            };

            action = keyMap[key];

            if (action) {
                updateInputDisplay(key.toUpperCase(), action);
                simulateAttack(action);
            }
        }

        function updateInputDisplay(key, action) {
            if (!gameState.debugMode) return;

            document.getElementById('lastInput').textContent = key;
            document.getElementById('lastAction').textContent = action;
        }

        function simulateAttack(action) {
            // Simulate damage
            const damage = Math.floor(Math.random() * 20) + 10;
            const severity = damage < 15 ? 'light' : damage < 25 ? 'moderate' : 'heavy';

            // Apply damage to player 2
            applyDamage(2, damage);

            // Show damage indicator
            showDamageIndicator(2, damage, severity);

            // Trigger attack animation
            const char1 = document.getElementById('character1');
            char1.classList.add('attacking');
            setTimeout(() => char1.classList.remove('attacking'), 300);

            // Trigger hit animation
            const char2 = document.getElementById('character2');
            char2.classList.add('hit');
            setTimeout(() => char2.classList.remove('hit'), 300);

            // Update combo
            gameState.comboCount++;
            if (gameState.comboCount > 1) {
                showCombo(gameState.comboCount);
            }

            // Reset combo after 2 seconds
            setTimeout(() => {
                gameState.comboCount = 0;
            }, 2000);
        }

        function applyDamage(playerNum, damage) {
            const player = playerNum === 1 ? gameState.player1 : gameState.player2;
            player.hp = Math.max(0, player.hp - damage);

            updateHealthBar(playerNum);

            // Check for KO
            if (player.hp === 0) {
                handleKO(playerNum);
            }
        }

        function updateHealthBar(playerNum) {
            const player = playerNum === 1 ? gameState.player1 : gameState.player2;
            const healthBar = document.getElementById(`player${playerNum}Health`);
            const healthText = document.getElementById(`player${playerNum}HealthText`);

            const percentage = (player.hp / player.maxHp) * 100;
            healthBar.style.width = percentage + '%';
            healthText.textContent = `${player.hp} / ${player.maxHp}`;

            // Update health bar color
            healthBar.classList.remove('low', 'critical');
            if (percentage <= 30) {
                healthBar.classList.add('critical');
            } else if (percentage <= 50) {
                healthBar.classList.add('low');
            }
        }

        function showDamageIndicator(playerNum, damage, severity) {
            const character = document.getElementById(`character${playerNum}`);
            const rect = character.getBoundingClientRect();

            // Create damage triangle
            const triangle = document.createElement('div');
            triangle.className = 'damage-indicator';
            triangle.innerHTML = `<div class="damage-triangle ${severity}"></div>`;
            triangle.style.left = (rect.left + rect.width / 2) + 'px';
            triangle.style.top = (rect.top + 50) + 'px';
            document.body.appendChild(triangle);

            // Create damage number
            const number = document.createElement('div');
            number.className = 'damage-number';
            number.textContent = `-${damage}`;
            number.style.left = (rect.left + rect.width / 2 - 20) + 'px';
            number.style.top = (rect.top + 20) + 'px';
            document.body.appendChild(number);

            // Remove after animation
            setTimeout(() => {
                triangle.remove();
                number.remove();
            }, 500);
        }

        function showCombo(count) {
            const comboDisplay = document.getElementById('comboDisplay');
            const comboNumber = document.getElementById('comboNumber');

            comboNumber.textContent = count;
            comboDisplay.classList.remove('hidden');

            setTimeout(() => {
                comboDisplay.classList.add('hidden');
            }, 1000);
        }

        function startRound() {
            // Show round announcer
            const announcer = document.getElementById('roundAnnouncer');
            const announcerText = document.getElementById('announcerText');

            announcerText.textContent = `ROUND ${gameState.round}`;
            announcer.classList.remove('hidden');

            setTimeout(() => {
                announcerText.textContent = 'FIGHT!';
                setTimeout(() => {
                    announcer.classList.add('hidden');
                    startTimer();
                }, 1000);
            }, 1500);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (gameState.isPaused) return;

                gameState.timer--;
                updateTimer();

                if (gameState.timer <= 0) {
                    clearInterval(timerInterval);
                    handleTimeUp();
                }
            }, 1000);
        }

        function updateTimer() {
            const timerElement = document.getElementById('timer');
            timerElement.textContent = gameState.timer;

            // Add warning/danger classes
            timerElement.classList.remove('warning', 'danger');
            if (gameState.timer <= 10) {
                timerElement.classList.add('danger');
            } else if (gameState.timer <= 30) {
                timerElement.classList.add('warning');
            }
        }

        function handleTimeUp() {
            // Determine winner by HP
            const winner = gameState.player1.hp > gameState.player2.hp ? 1 : 2;
            handleKO(winner === 1 ? 2 : 1);
        }

        function handleKO(loserNum) {
            clearInterval(timerInterval);

            const winnerNum = loserNum === 1 ? 2 : 1;
            const resultElement = document.getElementById('matchResult');
            const resultText = document.getElementById('resultText');

            resultText.textContent = winnerNum === 1 ? 'VICTORY!' : 'DEFEAT!';
            resultText.className = `result-text ${winnerNum === 1 ? 'victory' : 'defeat'}`;
            resultElement.classList.remove('hidden');

            // TODO: Update contract with battle result
            // await sdk.battles.executeTurn(battleId, action);

            setTimeout(() => {
                if (gameState.round < gameState.maxRounds) {
                    // Next round
                    gameState.round++;
                    resetRound();
                    resultElement.classList.add('hidden');
                    startRound();
                } else {
                    // Match over
                    setTimeout(() => {
                        exitToMenu();
                    }, 3000);
                }
            }, 3000);
        }

        function resetRound() {
            gameState.player1.hp = gameState.player1.maxHp;
            gameState.player2.hp = gameState.player2.maxHp;
            gameState.timer = gameState.maxTime;
            gameState.comboCount = 0;

            updateHealthBar(1);
            updateHealthBar(2);
            updateTimer();
            document.getElementById('roundInfo').textContent = `Round ${gameState.round} / ${gameState.maxRounds}`;
        }

        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            document.getElementById('pauseOverlay').classList.toggle('hidden');
        }

        function exitToMenu() {
            window.location.href = 'landing.html';
        }

        // Add status effect (demo function)
        function addStatusEffect(playerNum, type) {
            const statusContainer = document.getElementById(`player${playerNum}Status`);
            const statusIcon = document.createElement('div');
            statusIcon.className = 'status-icon';

            const icons = {
                stun: 'ðŸ˜µ',
                burn: 'ðŸ”¥',
                poison: 'â˜ ï¸',
                shield: 'ðŸ›¡ï¸'
            };

            statusIcon.textContent = icons[type] || '?';
            statusContainer.appendChild(statusIcon);

            // Remove after 5 seconds
            setTimeout(() => {
                statusIcon.remove();
            }, 5000);
        }
    </script>

</body>
</html>
